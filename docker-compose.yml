
services:
  # PostgREST for real Hydra database (used for development with real data)
  postgrest:
    image: "postgrest/postgrest:v14.3"
    environment:
      # Connect to Hydra CSV database
      - PGRST_DB_URI=postgres://postgres:postgres@host.docker.internal:5434/postgres
      - PGRST_SERVER_PORT=${PGREST_PORT:-8080}
      - PGRST_DB_ANON_ROLE=postgres
      - PGRST_DB_SCHEMA=public
      - PGRST_DB_AGGREGATES_ENABLED=true
    ports:
      - "${PGREST_PORT:-8080}:${PGREST_PORT:-8080}"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    profiles:
      - hydra

  # PostgREST for test database (used for running tests)
  postgrest-test:
    image: "postgrest/postgrest:v14.0"
    environment:
      # connect to hydra database-csv
      - PGRST_DB_URI=postgres://postgres:postgres@database-csv:5432/postgres
      - PGRST_SERVER_PORT=8080
      - PGRST_DB_ANON_ROLE=postgres
      - PGRST_DB_SCHEMA=public
      - PGRST_DB_AGGREGATES_ENABLED=true
    ports:
      - 8080:8080
    networks:
      - hydra_net

networks:
  hydra_net:
    external: true
